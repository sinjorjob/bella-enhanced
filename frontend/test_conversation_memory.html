<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bella ä¼šè©±å±¥æ­´æ©Ÿèƒ½ãƒ†ã‚¹ãƒˆ</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .test-section {
            margin-bottom: 30px;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        .test-input {
            width: 100%;
            padding: 10px;
            margin: 10px 0;
            border: 1px solid #ccc;
            border-radius: 5px;
        }
        .test-button {
            background: #007bff;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        .test-button:hover {
            background: #0056b3;
        }
        .result {
            background: #f8f9fa;
            padding: 10px;
            border-radius: 5px;
            margin-top: 10px;
            white-space: pre-wrap;
        }
        .debug-section {
            background: #e9ecef;
            padding: 15px;
            border-radius: 5px;
            margin-top: 20px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ¤– Bella ä¼šè©±å±¥æ­´æ©Ÿèƒ½ãƒ†ã‚¹ãƒˆ</h1>
        
        <div class="test-section">
            <h2>ğŸ“ ãƒ‘ã‚¿ãƒ¼ãƒ³æŠ½å‡ºãƒ†ã‚¹ãƒˆ</h2>
            <input type="text" class="test-input" id="extractionInput" 
                   placeholder="ä¾‹: ç§ã®åå‰ã¯ã—ã‚“ã‚„ã§ã™ã€‚è¦šãˆã¦ãŠã„ã¦ã­ï¼">
            <button class="test-button" onclick="testExtraction()">æƒ…å ±æŠ½å‡ºã‚’ãƒ†ã‚¹ãƒˆ</button>
            <div id="extractionResult" class="result"></div>
        </div>
        
        <div class="test-section">
            <h2>ğŸ’­ ä¼šè©±ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³</h2>
            <input type="text" class="test-input" id="messageInput" 
                   placeholder="ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„">
            <button class="test-button" onclick="simulateConversation()">ä¼šè©±ã‚’ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ãƒˆ</button>
            <div id="conversationResult" class="result"></div>
        </div>
        
        <div class="test-section">
            <h2>ğŸ§ª äº‹å‰å®šç¾©ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹</h2>
            <button class="test-button" onclick="runTestCase('name')">åå‰ç™»éŒ²ãƒ†ã‚¹ãƒˆ</button>
            <button class="test-button" onclick="runTestCase('memory')">è¨˜æ†¶ãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒ†ã‚¹ãƒˆ</button>
            <button class="test-button" onclick="runTestCase('birthday')">èª•ç”Ÿæ—¥ãƒ†ã‚¹ãƒˆ</button>
            <button class="test-button" onclick="runTestCase('preference')">å¥½ã¿ãƒ†ã‚¹ãƒˆ</button>
            <div id="testCaseResult" class="result"></div>
        </div>
        
        <div class="debug-section">
            <h2>ğŸ” ãƒ‡ãƒãƒƒã‚°æƒ…å ±</h2>
            <button class="test-button" onclick="showProfile()">ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«è¡¨ç¤º</button>
            <button class="test-button" onclick="showHistory()">å±¥æ­´è¡¨ç¤º</button>
            <button class="test-button" onclick="resetData()">ãƒ‡ãƒ¼ã‚¿ãƒªã‚»ãƒƒãƒˆ</button>
            <div id="debugResult" class="result"></div>
        </div>
        
        <div class="debug-section">
            <h2>ğŸ“ ãƒ•ã‚¡ã‚¤ãƒ«ä¿å­˜æ©Ÿèƒ½</h2>
            <button class="test-button" onclick="testFileExport()">JSONãƒ•ã‚¡ã‚¤ãƒ«ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ</button>
            <button class="test-button" onclick="testFileImport()">JSONãƒ•ã‚¡ã‚¤ãƒ«ã‚¤ãƒ³ãƒãƒ¼ãƒˆ</button>
            <button class="test-button" onclick="createBackup()">æ‰‹å‹•ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—</button>
            <button class="test-button" onclick="showFileSystemStatus()">ãƒ•ã‚¡ã‚¤ãƒ«ã‚·ã‚¹ãƒ†ãƒ çŠ¶æ…‹</button>
            <div id="fileResult" class="result"></div>
        </div>
    </div>

    <script src="js/userProfileExtractor.js"></script>
    <script src="js/fileManager.js"></script>
    <script src="js/conversationManager.js"></script>
    <script>
        const extractor = new UserProfileExtractor();
        const conversationManager = new ConversationManager();
        
        function testExtraction() {
            const input = document.getElementById('extractionInput').value;
            const result = extractor.extractMultipleInfo(input);
            document.getElementById('extractionResult').textContent = JSON.stringify(result, null, 2);
        }
        
        async function simulateConversation() {
            const input = document.getElementById('messageInput').value;
            try {
                const result = await conversationManager.processUserMessage(input);
                document.getElementById('conversationResult').textContent = JSON.stringify(result, null, 2);
            } catch (error) {
                document.getElementById('conversationResult').textContent = 'ã‚¨ãƒ©ãƒ¼: ' + error.message;
            }
        }
        
        function runTestCase(type) {
            const testCases = {
                name: [
                    'ç§ã®åå‰ã¯ã—ã‚“ã‚„ã§ã™ã€‚è¦šãˆã¦ãŠã„ã¦ã­ï¼',
                    'ãŸã‹ã—ã¨å‘¼ã‚“ã§ãã ã•ã„',
                    'åƒ•ã¯ã‚†ã†ãã§ã™'
                ],
                memory: [
                    'ã“ã‚Œã¯é‡è¦ãªã“ã¨ã ã‹ã‚‰è¦šãˆã¦ãŠã„ã¦',
                    'æ˜æ—¥ã¯ä¼šè­°ãŒã‚ã‚‹ã‹ã‚‰å¿˜ã‚Œãªã„ã§ã­',
                    'ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã¯123456ã€è¨˜éŒ²ã—ã¦ã­'
                ],
                birthday: [
                    'èª•ç”Ÿæ—¥ã¯3æœˆ15æ—¥ã§ã™',
                    '12æœˆ25æ—¥ã«ç”Ÿã¾ã‚Œã¾ã—ãŸ',
                    'ç§ã®èª•ç”Ÿæ—¥ã¯8æœˆ10æ—¥'
                ],
                preference: [
                    'ãƒ©ãƒ¼ãƒ¡ãƒ³ãŒå¤§å¥½ãã§ã™',
                    'é‡èœã¯å«Œã„ãªã‚“ã§ã™',
                    'ã‚¢ãƒ‹ãƒ¡ã«ãƒãƒã£ã¦ã¾ã™'
                ]
            };
            
            const cases = testCases[type] || [];
            let results = [];
            
            cases.forEach(testCase => {
                const result = extractor.extractMultipleInfo(testCase);
                results.push({
                    input: testCase,
                    output: result
                });
            });
            
            document.getElementById('testCaseResult').textContent = JSON.stringify(results, null, 2);
        }
        
        function showProfile() {
            const profile = conversationManager.loadUserProfile();
            document.getElementById('debugResult').textContent = JSON.stringify(profile, null, 2);
        }
        
        function showHistory() {
            const history = conversationManager.loadConversationHistory();
            document.getElementById('debugResult').textContent = JSON.stringify(history, null, 2);
        }
        
        function resetData() {
            if (confirm('å…¨ã¦ã®ãƒ‡ãƒ¼ã‚¿ã‚’ãƒªã‚»ãƒƒãƒˆã—ã¾ã™ã‹ï¼Ÿ')) {
                conversationManager.resetAllData();
                document.getElementById('debugResult').textContent = 'ãƒ‡ãƒ¼ã‚¿ã‚’ãƒªã‚»ãƒƒãƒˆã—ã¾ã—ãŸ';
            }
        }
        
        // ãƒ•ã‚¡ã‚¤ãƒ«ä¿å­˜æ©Ÿèƒ½ã®ãƒ†ã‚¹ãƒˆ
        function testFileExport() {
            const profile = conversationManager.loadUserProfile();
            const history = conversationManager.loadConversationHistory();
            
            // ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ
            const profileBlob = new Blob([JSON.stringify(profile, null, 2)], { type: 'application/json' });
            const profileUrl = URL.createObjectURL(profileBlob);
            const profileLink = document.createElement('a');
            profileLink.href = profileUrl;
            profileLink.download = 'bella_user_profile_test.json';
            profileLink.click();
            URL.revokeObjectURL(profileUrl);
            
            // å±¥æ­´ã‚’ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ
            const historyBlob = new Blob([JSON.stringify(history, null, 2)], { type: 'application/json' });
            const historyUrl = URL.createObjectURL(historyBlob);
            const historyLink = document.createElement('a');
            historyLink.href = historyUrl;
            historyLink.download = 'bella_conversation_history_test.json';
            historyLink.click();
            URL.revokeObjectURL(historyUrl);
            
            document.getElementById('fileResult').textContent = 'ğŸ“¥ JSONãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã—ã¾ã—ãŸ';
        }
        
        async function testFileImport() {
            try {
                const success = await conversationManager.importFromFile();
                document.getElementById('fileResult').textContent = success ? 
                    'âœ… ã‚¤ãƒ³ãƒãƒ¼ãƒˆãŒå®Œäº†ã—ã¾ã—ãŸ' : 
                    'âŒ ã‚¤ãƒ³ãƒãƒ¼ãƒˆã«å¤±æ•—ã—ã¾ã—ãŸ';
            } catch (error) {
                document.getElementById('fileResult').textContent = 'âŒ ã‚¨ãƒ©ãƒ¼: ' + error.message;
            }
        }
        
        async function createBackup() {
            try {
                const success = await conversationManager.createManualBackup();
                document.getElementById('fileResult').textContent = success ? 
                    'âœ… ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã‚’ä½œæˆã—ã¾ã—ãŸ' : 
                    'âŒ ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã®ä½œæˆã«å¤±æ•—ã—ã¾ã—ãŸ';
            } catch (error) {
                document.getElementById('fileResult').textContent = 'âŒ ã‚¨ãƒ©ãƒ¼: ' + error.message;
            }
        }
        
        function showFileSystemStatus() {
            const status = conversationManager.getFileSystemStatus();
            document.getElementById('fileResult').textContent = JSON.stringify(status, null, 2);
        }
        
        // åˆæœŸçŠ¶æ…‹ã®è¡¨ç¤º
        document.addEventListener('DOMContentLoaded', () => {
            console.log('ğŸ¤– Bella ä¼šè©±å±¥æ­´æ©Ÿèƒ½ãƒ†ã‚¹ãƒˆãƒšãƒ¼ã‚¸ãŒèª­ã¿è¾¼ã¾ã‚Œã¾ã—ãŸ');
            console.log('ä½¿ç”¨å¯èƒ½ãªãƒ‡ãƒãƒƒã‚°é–¢æ•°:');
            console.log('- testExtraction(): ãƒ‘ã‚¿ãƒ¼ãƒ³æŠ½å‡ºãƒ†ã‚¹ãƒˆ');
            console.log('- simulateConversation(): ä¼šè©±ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³');
            console.log('- showProfile(): ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«è¡¨ç¤º');
            console.log('- showHistory(): å±¥æ­´è¡¨ç¤º');
            console.log('- resetData(): ãƒ‡ãƒ¼ã‚¿ãƒªã‚»ãƒƒãƒˆ');
        });
    </script>
</body>
</html>